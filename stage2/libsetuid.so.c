/*
* libsetuid.so.c
*
* Coded by TeamCR@K
*
* http://teamcrak.tistory.com
*
* - A example code for wrapped function of setuid()
*/
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <dlfcn.h>

static int (*orig_setuid)(uid_t uid);

int setuid(uid_t uid)
{
	int ret = 0;
	void *dl = NULL;
	char exe[1024] = {0,};

	readlink("/proc/self/exe", exe, sizeof(exe));
	fprintf(stdout, "[DEBUG] Hooked setuid(%d) by '%s'\n", uid, exe);
	if((dl = dlopen("/lib/libc.so.6", RTLD_LAZY)) != NULL) {
		if((orig_setuid = dlsym(dl, "setuid")) != NULL) {
			ret = orig_setuid(uid);
		}
		dlclose(dl);
	}
	return ret;
}
